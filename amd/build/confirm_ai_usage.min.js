define("local_ai_injection/confirm_ai_usage",["exports","local_ai_manager/infobox","local_ai_manager/warningbox","core/modal","core/modal_events","core/localstorage","core/config"],(function(_exports,_infobox,_warningbox,_modal,_modal_events,_localstorage,_config){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showAiInfo=_exports.isAiUsageConfirmed=_exports.confirmAiUsage=void 0,_modal=_interopRequireDefault(_modal),_modal_events=_interopRequireDefault(_modal_events),_localstorage=_interopRequireDefault(_localstorage);const getStorageKey=async()=>(async stringToHash=>{const data=(new TextEncoder).encode(stringToHash),hashAsArrayBuffer=await window.crypto.subtle.digest("SHA-256",data),uint8ViewOfHash=new Uint8Array(hashAsArrayBuffer);return Array.from(uint8ViewOfHash).map((b=>b.toString(16).padStart(2,"0"))).join("")})("local_ai_injection_ai_confirmed_"+_config.userId);_exports.isAiUsageConfirmed=async()=>{const key=await getStorageKey();return"1"===_localstorage.default.get(key)};class ConfirmModal extends _modal.default{configure(modalConfig){modalConfig.removeOnClose=!0,this.registerCloseOnCancel(),this.registerCloseOnSave(),super.configure(modalConfig)}}_defineProperty(ConfirmModal,"TYPE","local_ai_injection/confirm_ai_usage_modal"),_defineProperty(ConfirmModal,"TEMPLATE","local_ai_injection/confirm_ai_usage_modal");_exports.confirmAiUsage=async function(component){let purposes=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const storageKey=await getStorageKey();if("1"===_localstorage.default.get(storageKey))return!0;const modal=await ConfirmModal.create({show:!0,templateContext:{infoonly:!1}}),container=modal.getBody()[0].querySelector(".local_ai_injection-confirm-content");return await(0,_infobox.renderInfoBox)(component,_config.userId,container,purposes),await(0,_warningbox.renderWarningBox)(container),new Promise((resolve=>{modal.getRoot().on(_modal_events.default.save,(()=>{_localstorage.default.set(storageKey,"1"),resolve(!0),modal.destroy()})),modal.getRoot().on(_modal_events.default.hidden,(()=>{resolve(!1)}))}))};_exports.showAiInfo=async function(component){let purposes=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const modal=await ConfirmModal.create({show:!0,templateContext:{infoonly:!0}}),container=modal.getBody()[0].querySelector(".local_ai_injection-confirm-content");await(0,_infobox.renderInfoBox)(component,_config.userId,container,purposes),await(0,_warningbox.renderWarningBox)(container)}}));

//# sourceMappingURL=confirm_ai_usage.min.js.map